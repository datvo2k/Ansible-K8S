---
# Kubernetes Cluster

- name: Common Parts
  hosts: all-nodes
  become: yes
  roles:
    - role: docker
    - role: common
      version: 1.25.4

- name: Master
  hosts: kube-master
  become: yes
  roles:
  - role: kubernetes-master
    version: 1.25.4
    cidr: 10.244.0.0/16
    ip: "{{ hostvars['master1']['ansible_host'] }}" 
    user: "{{ hostvars['master1']['ansible_user'] }}" 
    k8s_middle_server: k8s_middle_server

- name: Workers
  gather_facts: yes
  hosts: workers
  become: yes
  roles:
  - role: kubernetes-worker
    version: 1.25.4
    k8s_middle_server: k8s_middle_server 

- name: Local
  hosts: 127.0.0.1
  connection: local
  tasks:
  - name: Getting Kubernetes configuration
    local_action: copy content={{ hostvars['k8s_middle_server']['kube_config'] }} dest=mykubeconfig   